<project>
    <shortName>pyTivo</shortName>
    <fullName>pyTivo</fullName>
    <version>1.6.22</version>
    <installerFilename>${product_shortname}-${product_version}-installer.${platform_exec_suffix}</installerFilename>
    <leftImage>resources/left.png</leftImage>
    <logoImage>resources/top.png</logoImage>
    <splashImage>resources/splash.png</splashImage>
    <componentList>
        <component>
            <name>default</name>
            <description>Default Component</description>
            <canBeEdited>1</canBeEdited>
            <selected>1</selected>
            <show>1</show>
            <folderList>
                <folder>
                    <description>Program Files</description>
                    <destination>${installdir}</destination>
                    <name>programfiles</name>
                    <platforms>all</platforms>
                </folder>
                <folder>
                    <description>Program Files</description>
                    <destination>${installdir}</destination>
                    <name>programfileslinux</name>
                    <platforms>linux</platforms>
                </folder>
                <folder>
                    <description>Program Files</description>
                    <destination>${installdir}</destination>
                    <name>programfileswindows</name>
                    <platforms>windows</platforms>
                    <distributionFileList>
                        <distributionFile>
                            <origin>../build/pyTivo.exe</origin>
                        </distributionFile>
                        <distributionFile>
                            <origin>../build/pyTivoTray.exe</origin>
                        </distributionFile>
                        <distributionDirectory>
                            <origin>../build/desktop</origin>
                        </distributionDirectory>
                        <distributionDirectory>
                            <origin>../build/bin</origin>
                        </distributionDirectory>
                        <distributionDirectory>
                            <origin>../build/dshow</origin>
                        </distributionDirectory>
                    </distributionFileList>
                </folder>
                <folder>
                    <description>Program Files</description>
                    <destination>${installdir}</destination>
                    <name>programfilesosx</name>
                    <platforms>osx</platforms>
                    <distributionFileList>
                        <distributionFile>
                            <origin>../build/pyTivoDesktop.app</origin>
                        </distributionFile>
                        <distributionFile>
                            <origin>../build/pyTivo.app</origin>
                        </distributionFile>
                        <distributionDirectory>
                            <origin>../build/bin</origin>
                        </distributionDirectory>
                        <distributionFile>
                            <origin>../build/LICENSES.chromium.html</origin>
                        </distributionFile>
                        <distributionDirectory>
                            <origin>../build/seticon</origin>
                        </distributionDirectory>
                    </distributionFileList>
                </folder>
            </folderList>
            <startMenuShortcutList>
                <startMenuShortcut>
                    <comment></comment>
                    <name>pyTivo</name>
                    <runAsAdmin>0</runAsAdmin>
                    <runInTerminal>0</runInTerminal>
                    <windowsExec>${installdir}/pyTivoTray.exe</windowsExec>
                    <windowsExecArgs></windowsExecArgs>
                    <windowsIcon>${installdir}/pyTivoTray.exe</windowsIcon>
                    <windowsPath>${installdir}/</windowsPath>
                </startMenuShortcut>
                <startMenuShortcut>
                    <comment></comment>
                    <name>pyTivo Desktop</name>
                    <runAsAdmin>0</runAsAdmin>
                    <runInTerminal>0</runInTerminal>
                    <windowsExec>${installdir}/desktop/pyTivoDesktop.exe</windowsExec>
                    <windowsExecArgs></windowsExecArgs>
                    <windowsIcon>${installdir}/desktop/pyTivoDesktop.exe</windowsIcon>
                    <windowsPath>${installdir}/desktop/</windowsPath>
                </startMenuShortcut>
            </startMenuShortcutList>
        </component>
    </componentList>
    <preInstallationActionList>
        <iniFileGet>
            <abortOnError>0</abortOnError>
            <file>${windows_folder_appdata}/pyTivo/pytivo.conf</file>
            <key>tivo_mak</key>
            <section>Server</section>
            <showMessageOnError>0</showMessageOnError>
            <variable>tivomak</variable>
            <ruleList>
                <platformTest type="windows"/>
            </ruleList>
        </iniFileGet>
        <iniFileGet>
            <abortOnError>0</abortOnError>
            <file>${windows_folder_appdata}/pyTivo/pytivo.conf</file>
            <key>togo_path</key>
            <section>Server</section>
            <showMessageOnError>0</showMessageOnError>
            <variable>togopath</variable>
            <ruleList>
                <platformTest type="windows"/>
            </ruleList>
        </iniFileGet>
        <iniFileGet>
            <abortOnError>0</abortOnError>
            <file>${installdir}/pytivo.conf</file>
            <key>tivo_mak</key>
            <section>Server</section>
            <showMessageOnError>0</showMessageOnError>
            <variable>tivomak</variable>
            <ruleList>
                <platformTest type="osx"/>
            </ruleList>
        </iniFileGet>
        <iniFileGet>
            <abortOnError>0</abortOnError>
            <file>${installdir}/pytivo.conf</file>
            <key>togo_path</key>
            <section>Server</section>
            <showMessageOnError>0</showMessageOnError>
            <variable>togopath</variable>
            <ruleList>
                <platformTest type="osx"/>
            </ruleList>
        </iniFileGet>
        <while>
            <conditionRuleEvaluationLogic>or</conditionRuleEvaluationLogic>
            <actionList>
                <showWarning>
                    <text>pyTivo is currently running, please close it before proceeding</text>
                </showWarning>
            </actionList>
            <conditionRuleList>
                <processTest>
                    <logic>is_running</logic>
                    <name>pyTivo</name>
                </processTest>
                <processTest>
                    <logic>is_running</logic>
                    <name>pyTivoTray</name>
                </processTest>
                <processTest>
                    <logic>is_running</logic>
                    <name>pyTivoDesktop</name>
                </processTest>
            </conditionRuleList>
        </while>
    </preInstallationActionList>
    <postInstallationActionList>
        <iniFileSet>
            <file>${installdir}/pytivo.conf</file>
            <key>tivo_mak</key>
            <section>Server</section>
            <value>${tivomak}</value>
            <ruleList>
                <platformTest>
                    <type>osx</type>
                </platformTest>
            </ruleList>
        </iniFileSet>
        <iniFileSet>
            <file>${installdir}/pytivo.conf</file>
            <key>togo_path</key>
            <section>Server</section>
            <value>${togopath}</value>
            <ruleList>
                <platformTest>
                    <type>osx</type>
                </platformTest>
            </ruleList>
        </iniFileSet>
        <iniFileSet>
            <file>${installdir}/pytivo.conf</file>
            <key>path</key>
            <section>TiVo Recordings</section>
            <value>${togopath}</value>
            <ruleList>
                <isTrue>
                    <value>${publishpath}</value>
                </isTrue>
                <platformTest>
                    <type>osx</type>
                </platformTest>
            </ruleList>
        </iniFileSet>
        <iniFileSet>
            <file>${installdir}/pytivo.conf</file>
            <key>type</key>
            <section>TiVo Recordings</section>
            <value>video</value>
            <ruleList>
                <isTrue>
                    <value>${publishpath}</value>
                </isTrue>
                <platformTest>
                    <type>osx</type>
                </platformTest>
            </ruleList>
        </iniFileSet>
        <runProgram>
            <abortOnError>0</abortOnError>
            <program>${installdir}/seticon/seticon</program>
            <programArguments>-d ${installdir}/seticon/folder.icns ${installdir}</programArguments>
            <show>0</show>
            <showMessageOnError>0</showMessageOnError>
            <ruleList>
                <platformTest>
                    <type>osx</type>
                </platformTest>
            </ruleList>
        </runProgram>
        <writeFile>
            <path>~/Library/LaunchAgents/com.pytivo.pytivo.plist</path>
            <text>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd"&gt;
&lt;plist version="1.0"&gt;
  &lt;dict&gt;
    &lt;key&gt;Label&lt;/key&gt;
    &lt;string&gt;com.pytivo.app&lt;/string&gt;
    &lt;key&gt;ProgramArguments&lt;/key&gt;
    &lt;array&gt;
      &lt;string&gt;open&lt;/string&gt;
      &lt;string&gt;-a&lt;/string&gt;
      &lt;string&gt;${installdir}/pyTivo.app&lt;/string&gt;
    &lt;/array&gt;
    &lt;key&gt;RunAtLoad&lt;/key&gt;
    &lt;true/&gt;
  &lt;/dict&gt;
&lt;/plist&gt;</text>
            <ruleList>
                <isTrue>
                    <value>${startwithuser}</value>
                </isTrue>
                <platformTest>
                    <type>osx</type>
                </platformTest>
            </ruleList>
        </writeFile>
        <deleteFile>
            <abortOnError>0</abortOnError>
            <path>~/Library/LaunchAgents/com.pytivo.pytivo.plist</path>
            <showMessageOnError>0</showMessageOnError>
            <ruleList>
                <platformTest>
                    <type>osx</type>
                </platformTest>
                <isFalse>
                    <value>${startwithuser}</value>
                </isFalse>
            </ruleList>
        </deleteFile>
    </postInstallationActionList>
    <postUninstallationActionList>
        <deleteFile>
            <abortOnError>0</abortOnError>
            <path>~/Library/LaunchAgents/com.pytivo.pytivo.plist</path>
            <showMessageOnError>0</showMessageOnError>
            <ruleList>
                <platformTest>
                    <type>osx</type>
                </platformTest>
            </ruleList>
        </deleteFile>
    </postUninstallationActionList>
    <createOsxBundleDmg>1</createOsxBundleDmg>
    <enableRollback>0</enableRollback>
    <enableTimestamp>1</enableTimestamp>
    <osxApplicationBundleIcon>resources/icon.icns</osxApplicationBundleIcon>
    <osxDmgTitle>Double Click To Install</osxDmgTitle>
    <osxSigningIdentity>Robert Haddix</osxSigningIdentity>
    <osxUninstallerApplicationBundleIcon>resources/icon.icns</osxUninstallerApplicationBundleIcon>
    <outputDirectory>../build/installer</outputDirectory>
    <saveRelativePaths>1</saveRelativePaths>
    <singleInstanceCheck>1</singleInstanceCheck>
    <vendor>Dan Haddix</vendor>
    <windowsExecutableIcon>resources/icon.ico</windowsExecutableIcon>
    <windowsResourceFileVersion>${product_version}</windowsResourceFileVersion>
    <windowsUninstallerExecutableIcon>resources/icon.ico</windowsUninstallerExecutableIcon>
    <finalPageActionList>
        <runProgram>
            <program>${installdir}/pyTivoTray.exe</program>
            <programArguments>--show-desktop &amp;</programArguments>
            <progressText>Start pyTivo Now</progressText>
            <ruleList>
                <platformTest type="windows"/>
            </ruleList>
        </runProgram>
        <runProgram>
            <program>open</program>
            <programArguments>-a ${installdir}/pyTivo.app  --args --show-desktop</programArguments>
            <progressText>Start pyTivo Now</progressText>
            <ruleList>
                <platformTest type="osx"/>
            </ruleList>
        </runProgram>
        <deleteFile>
            <abortOnError>0</abortOnError>
            <path>${installdir}/pyTivo</path>
            <show>0</show>
            <showMessageOnError>0</showMessageOnError>
            <ruleList>
                <platformTest>
                    <type>osx</type>
                </platformTest>
            </ruleList>
        </deleteFile>
        <deleteFile>
            <abortOnError>0</abortOnError>
            <path>${installdir}/pyTivoTray.app</path>
            <show>0</show>
            <showMessageOnError>0</showMessageOnError>
            <ruleList>
                <platformTest>
                    <type>osx</type>
                </platformTest>
            </ruleList>
        </deleteFile>
        <deleteFile>
            <abortOnError>0</abortOnError>
            <path>${installdir}/seticon</path>
            <show>0</show>
            <showMessageOnError>0</showMessageOnError>
            <ruleList>
                <platformTest>
                    <type>osx</type>
                </platformTest>
            </ruleList>
        </deleteFile>
    </finalPageActionList>
    <parameterList>
        <directoryParameter>
            <name>installdir</name>
            <description>Installer.Parameter.installdir.description</description>
            <explanation>Installer.Parameter.installdir.explanation</explanation>
            <value></value>
            <default>${platform_install_prefix}/${product_shortname}</default>
            <allowEmptyValue>0</allowEmptyValue>
            <ask>yes</ask>
            <cliOptionName>prefix</cliOptionName>
            <mustBeWritable>yes</mustBeWritable>
            <mustExist>0</mustExist>
            <width>30</width>
        </directoryParameter>
        <parameterGroup>
            <name>togoconfig</name>
            <title>Set options for ToGo functions</title>
            <explanation></explanation>
            <value></value>
            <default></default>
            <insertAfter>installdir</insertAfter>
            <parameterList>
                <stringParameter>
                    <name>tivomak</name>
                    <description>TiVo Media Access Key</description>
                    <explanation></explanation>
                    <value></value>
                    <default></default>
                    <allowEmptyValue>1</allowEmptyValue>
                    <width>30</width>
                    <validationActionList>
                        <throwError>
                            <customErrorMessage>TiVo Media Access Key must be 10 digits</customErrorMessage>
                            <ruleEvaluationLogic>or</ruleEvaluationLogic>
                            <text>Invalid Media Access Key</text>
                            <ruleList>
                                <compareTextLength>
                                    <length>10</length>
                                    <logic>does_not_equal</logic>
                                    <text>${tivomak}</text>
                                </compareTextLength>
                                <stringTest>
                                    <text>${tivomak}</text>
                                    <type>not_digit</type>
                                </stringTest>
                            </ruleList>
                        </throwError>
                    </validationActionList>
                </stringParameter>
                <directoryParameter>
                    <name>togopath</name>
                    <description>TiVo recordings folder</description>
                    <explanation></explanation>
                    <value></value>
                    <default></default>
                    <allowEmptyValue>0</allowEmptyValue>
                    <mustBeWritable>1</mustBeWritable>
                    <mustExist>1</mustExist>
                    <osxBundlesAreFiles>1</osxBundlesAreFiles>
                    <width>30</width>
                </directoryParameter>
                <booleanParameter>
                    <name>publishpath</name>
                    <description>Publish recordings folder as video share</description>
                    <explanation></explanation>
                    <value>1</value>
                    <default>1</default>
                    <displayStyle>checkbox-left</displayStyle>
                </booleanParameter>
            </parameterList>
        </parameterGroup>
        <booleanParameter>
            <name>startwithuser</name>
            <description>Start pyTivo when user logs on</description>
            <explanation></explanation>
            <value>true</value>
            <default>true</default>
        </booleanParameter>
    </parameterList>
</project>

